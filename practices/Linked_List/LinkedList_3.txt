#include <iostream>
#include <stdlib.h>
#include <time.h>
#include <windows.h>
#include <conio.h>

#define WIDTH 30
#define HEIGHT 20

using namespace std;

void gotoxy(int,int);
void gotoxy(int x,int y){
	HANDLE hConsoleOutput;
    COORD Cursor_Pos={x,y};
    hConsoleOutput = GetStdHandle(STD_OUTPUT_HANDLE);
    SetConsoleCursorPosition(hConsoleOutput,Cursor_Pos);
}

class Node{
	public:
		int x;
		int y;
		int timer;
		Node *next = NULL;
		clock_t start = clock();
        clock_t finish = clock();

	Node(){
		x=rand()%WIDTH;
		y=rand()%HEIGHT;
		timer=9;
		Print();
	}

	void Print(){
		gotoxy(x,y);
		cout<<timer;
	}

	void Countdown()
	{
	    finish = clock();
	    if((finish - start)>=1000)
        {
            timer--;
            start = clock();
        }
	}
};

class LinkedList{
	private:
		Node *p = NULL;

	public:
		LinkedList(){
			p=NULL;
		}
		void Insert(Node *newNode){
			if(p==NULL){
				p = newNode;
				p->next = p;
			}
			else{
				newNode->next = p->next;
				p->next = newNode;
			}
			PrintList();
		}

		void PrintList(){
			Node *q = NULL;
			q=p;
			if(p == NULL) //At the beggining, p is pointing to nothing, so if dont have this evaluation, it will have mistake.( nothing to "goto")
                return;
			do{
				q->Print();
				q->Countdown();
				q=q->next;
			}while(q!=p);
		}
};


class UI{
public:
    char PressedKey(){
        if(kbhit())
            return getch();

        else
            return NULL;
    }

    void Action(LinkedList *List = NULL){
        List -> PrintList(); //Go to the train head and go around
        Node *newNode = NULL;
        switch(PressedKey()){
            case 'A':
            case 'a':
                newNode = new Node;
                List->Insert(newNode);
                break;
        }
    }
};


int main(){
	srand(time(NULL));

	LinkedList *List = new LinkedList;

	UI ui;

	while(1){
		ui.Action(List);
	}

	return 0;
}